# Safe Smart Account - Foundry Deployment

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–µ–ø–ª–æ—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ Safe Smart Account —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Foundry** –≤–º–µ—Å—Ç–æ Hardhat.

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Foundry

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π linking –±–∏–±–ª–∏–æ—Ç–µ–∫** - `MarshalLib` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ª–∏–Ω–∫—É–µ—Ç—Å—è —Å `ExtensibleFallbackHandler`
- **–ë—ã—Å—Ç—Ä–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è** - Rust-based –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –Ω–∞–º–Ω–æ–≥–æ –±—ã—Å—Ç—Ä–µ–µ
- **–ü—Ä–æ—Å—Ç—ã–µ Solidity —Å–∫—Ä–∏–ø—Ç—ã** - –¥–µ–ø–ª–æ–π –Ω–∞ —á–∏—Å—Ç–æ–º Solidity –±–µ–∑ JavaScript
- **–í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–∏–º—É–ª—è—Ü–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–ø–ª–æ—è –±–µ–∑ —Ç—Ä–∞—Ç –≥–∞–∑–∞

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ Foundry —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
forge --version

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
cd /Users/pavel/Desktop/work/KaspaCom/safe-forge-deploy
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å .env —Ñ–∞–π–ª
cp env-example .env

# –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
echo "PRIVATE_KEY=0xYOUR_PRIVATE_KEY_HERE" > .env
```

### 3. –ö–æ–º–ø–∏–ª—è—Ü–∏—è

```bash
forge build
```

### 4. –°–∏–º—É–ª—è—Ü–∏—è –¥–µ–ø–ª–æ—è

```bash
# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è)
forge script script/DeploySafe.s.sol
```

### 5. –†–µ–∞–ª—å–Ω—ã–π –¥–µ–ø–ª–æ–π

```bash
# –î–µ–ø–ª–æ–π –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é —Å–µ—Ç—å (Anvil/Hardhat)
forge script script/DeploySafe.s.sol --rpc-url http://localhost:8545 --broadcast

# –î–µ–ø–ª–æ–π –Ω–∞ —Ç–µ—Å—Ç–æ–≤—É—é —Å–µ—Ç—å
forge script script/DeploySafe.s.sol --rpc-url $RPC_URL --broadcast --verify
```

## üìã –î–µ–ø–ª–æ–µ–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã

–°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ–∏—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã Safe –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ:

### –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏:
- `CreateCall` - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ Safe
- `MultiSend` - –ë–∞—Ç—á–∏–Ω–≥ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π  
- `MultiSendCallOnly` - –ë–∞—Ç—á–∏–Ω–≥ —Ç–æ–ª—å–∫–æ call'–æ–≤
- `SignMessageLib` - –ü–æ–¥–ø–∏—Å—å —Å–æ–æ–±—â–µ–Ω–∏–π
- `SafeToL2Setup` - –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ L2

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã:
- `Safe` - –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –º—É–ª—å—Ç–∏—Å–∏–≥ –∫–æ—à–µ–ª—å–∫–∞
- `SafeL2` - L2-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
- `SafeProxyFactory` - –§–∞–±—Ä–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Safe –ø—Ä–æ–∫—Å–∏

### –•–µ–Ω–¥–ª–µ—Ä—ã:
- `TokenCallbackHandler` - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤
- `CompatibilityFallbackHandler` - –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- `ExtensibleFallbackHandler` - –†–∞—Å—à–∏—Ä—è–µ–º—ã–π —Ö–µ–Ω–¥–ª–µ—Ä (**—Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!**)

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:
- `SimulateTxAccessor` - –°–∏–º—É–ª—è—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- `SafeMigration` - –ú–∏–≥—Ä–∞—Ü–∏—è –≤–µ—Ä—Å–∏–π Safe

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**foundry.toml** –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞:
- Solidity 0.7.6 (–∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ)
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å 200 runs
- EVM –≤–µ—Ä—Å–∏—è London
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π linking –±–∏–±–ª–∏–æ—Ç–µ–∫

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- **MarshalLib**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–∏–Ω–∫—É–µ—Ç—Å—è —Å `ExtensibleFallbackHandler` (—Ä–µ—à–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∏–∑ Hardhat)
- **–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á**: –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–µ—Ñ–∏–∫—Å `0x`
- **Gas cost**: ~9.9M gas –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –≤—Å–µ—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω

## ‚ö° –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å Hardhat

| –ê—Å–ø–µ–∫—Ç | Foundry ‚úÖ | Hardhat ‚ùå |
|--------|-----------|-----------|
| –ö–æ–º–ø–∏–ª—è—Ü–∏—è | ~2s | ~30s |
| Library linking | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ | –û—à–∏–±–∫–∏ |
| ExtensibleFallbackHandler | –†–∞–±–æ—Ç–∞–µ—Ç | –ù–µ –¥–µ–ø–ª–æ–∏—Ç—Å—è |
| –°–∏–º—É–ª—è—Ü–∏—è | –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è | –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| –°–∫—Ä–∏–ø—Ç—ã | Solidity | TypeScript |

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ

Foundry —É—Å–ø–µ—à–Ω–æ —Ä–µ—à–∏–ª –ø—Ä–æ–±–ª–µ–º—ã —Å linking –±–∏–±–ª–∏–æ—Ç–µ–∫, –∫–æ—Ç–æ—Ä—ã–µ –≤–æ–∑–Ω–∏–∫–∞–ª–∏ –≤ Hardhat.